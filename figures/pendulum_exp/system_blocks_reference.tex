\documentclass[10pt,tikz]{standalone}

\ifstandalone%
\usepackage{import}
\import{../../configuration/}{comon_packages.tex}%
\import{../../configuration/}{variables.tex}%
\import{../../configuration/}{conftikz.tex}%
\import{../../configuration/}{custom_config.tex}%
\fi

\begin{document}
\begin{tikzpicture}
  % Parameters
  \def\spacing{1.0}
  \def\blockw{1.2cm}
  \def\blockh{1.0cm}
  \def\addsize{0.7cm}

  % Blocks
  \node[draw, DAC] (dac) {DAC};
  \node[draw, block, minimum width=2*\blockw, right=\spacing of dac, label={[align=center]below:Current\\Injector}] (ci) {};
  \node[draw, gain right, minimum width=0.7*\blockw] (ci_gain) at ($(ci)+(-0.5*\blockw, 0)$) {};
  \node[draw, add] (addi) at ($(ci)+(0.5*\blockw, 0)$) {};
  \node[draw, block, right=\spacing of ci, label={[align=center]below:Voice\\Coil}] (vc) {$H_{\text{VC}}$};
  \node[draw, block, right=\spacing of vc] (G) {$\hat{G}$};
  \node[draw, add, right=0.5*\spacing of G] (addy) {};
  \node[draw, block, above=0.5*\spacing of addy] (Gd) {$\hat{G}_d$};
  \node[draw, block, right=\spacing of addy, label={[align=center]below:Interferometer}] (int) {};
  \node[draw, add] (addn) at (int) {};
  \node[draw, ADC, right=1.2*\spacing of int] (adc) {ADC};
  \node[draw, add, right=0.8*\spacing of adc] (addr) {};
  \coordinate[] (adc_output) at ($(adc.east) + (0.8*\spacing, 0)$);
  \coordinate[] (dac_input) at ($(dac.west) + (-0.8*\spacing, 0)$);
  \node[draw, block, below=\spacing of G, label={[align=center]below:Controller}] (K) {$\hat{K}$};

  % Connections and labels
  \draw[->] (adc.east) -- (addr.west);
  \draw[->] (addr.south) |- (K.east);
  \draw[->] (K.west) -| (dac_input) -- (dac.west);
  \draw[->] (dac.east) -- (ci_gain.west);
  \draw[->] (ci_gain.east) -- (addi.west);
  \node[above left] at (ci.west){$\hat{u}[V]$};
  \draw[->] (addi.east) -- (vc.west) node[above left]{$\hat{I}[A]$};
  \draw[->] (vc.east) -- (G.west) node[above left]{$\hat{F}[N]$};
  \draw[->] (G.east) -- (addy.west);
  \draw[->] (addy.east) -- (addn.west);
  \node[above left] at (int.west) {$\hat{d}[m]$};
  \draw[->] (addn.east) -- (adc.west) node[above left]{$\hat{d}_m[m]$};
  \draw[<-] (addr.north) -- ++(0, 0.8*\spacing) node[right]{$\hat{r}[m]$};
  \draw[->] (Gd.south) -- (addy.north);
  \draw[<-] (Gd.north) -- ++(0, 0.8*\spacing) node[right]{$\hat{x}_g[m]$};
  \draw[<-] (addi.north) -- ++(0, 0.8*\spacing) node[right]{$\hat{n}_i[A]$};
  \draw[<-] (addn.north) -- ++(0, 0.8*\spacing) node[right]{$\hat{n}[m]$};
\end{tikzpicture}
\end{document}

